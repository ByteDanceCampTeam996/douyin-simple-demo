# 项目开发笔记

### 一.基本功能:

所有基本功能都已实现完成

### 二.可读性：

使用vscode自带的Go fmt模块保持代码风格的一致，统一使用中文注释

### 三.单元测试：

单元测试分为三个部分，分别是对controller，dao和service模块的单元测试。
* 对dao模块的测试使用sqltest模拟mysql数据库，测试数据库操作逻辑,参见user_db_test.go，运行测试使用
```shell
go test -v github.com/ByteDanceCampTeam996/douyin-simple-demo/dao
```
* 对service的测试使用Go monkey进行打桩，以测试业务逻辑是否工作正常，运行测试使用
```shell
go test -v github.com/ByteDanceCampTeam996/douyin-simple-demo/service -gcflags=all=-l
```
* 对controller的测试使用httptest模拟http请求，使用测试用数据库进行测试，参见main_test.go
```shell
go test -v github.com/ByteDanceCampTeam996/douyin-simple-demo
```

### 四.性能：

* 大部分数据使用Mysql进行存储。其中db_user_infos，即存储用户登录信息的表，由于登录时使用用户名查询较为频繁，所以使用用户名作为主键。

### 五.安全：

* 用户的账号密码信息存储时，使用SHA-256对密码进行哈希，从用户名中提取信息用作盐值，将密码和盐值拼接后哈希，可以有效抵抗服务器端的数据泄露以及简单碰撞，彩虹表等针对用户密码的攻击行为。
* 项目使用Gorm访问数据库，GORM使用database/sql的参数占位符来构造 SQL 语句，这可以自动转义参数，避免SQL注入。但对于用户输入的主键检索等记录由于功能上的需要不支持自动转义，项目中实现了简单的基于正则表达式的sql过滤，检测危险输入中是否包含sql命令以及特殊符号，如果存在，则判定为危险输入，不予执行。

